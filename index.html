<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل الدخول</title>
    <style>
        @font-face {
            font-family: 'CustomArabicFont';
            src: url('CustomArabicFont.ttf') format('truetype');
        }

        * {
            font-family: 'CustomArabicFont', Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #1e2a44, #2c3e50);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 30px;
            width: 350px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .login-box {
            text-align: center;
        }

        .logo {
            width: 80px;
            height: auto;
            margin-bottom: 15px;
        }

        h2 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: right;
        }

        .input-group label {
            color: #ddd;
            font-size: 14px;
            margin-bottom: 5px;
            display: block;
        }

        .input-group svg {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            fill: #ddd;
            transition: fill 0.3s ease;
        }

        .input-group input {
            width: 100%;
            padding: 10px 12px 10px 35px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 20px;
            color: #fff;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
        }

        .input-group input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }

        .input-group input:focus + svg {
            fill: #00e676;
        }

        .btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(45deg, #00e676, #00c853);
            border: none;
            border-radius: 20px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 230, 118, 0.4);
        }

        .links {
            margin-top: 15px;
        }

        .links a {
            color: #ddd;
            text-decoration: none;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .links a:hover {
            color: #00e676;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: #fff;
            z-index: 1000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-text {
            margin-top: 15px;
            font-size: 16px;
        }

        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            width: 300px;
            text-align: center;
            color: #fff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 2000;
            animation: fadeOut 5s forwards;
        }

        .popup.active {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .popup svg {
            width: 40px;
            height: 40px;
            fill: #00e676;
            margin-bottom: 10px;
        }

        .popup p {
            font-size: 16px;
            color: #00e676;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="login-box">
            <img src="logo.png" alt="شعار" class="logo">
            <h2>تسجيل الدخول</h2>
            <form id="loginForm">
                <div class="input-group">
                    <label>رقم الهاتف أو البريد الإلكتروني</label>
                    <div style="position: relative;">
                        <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                        <input type="text" id="identifier" required>
                    </div>
                </div>
                <div class="input-group">
                    <label>كلمة المرور</label>
                    <div style="position: relative;">
                        <svg viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/></svg>
                        <input type="password" id="password" required>
                    </div>
                </div>
                <button type="submit" class="btn">تسجيل الدخول</button>
            </form>
            <div class="links">
                <a href="newpass.html">هل نسيت كلمة المرور؟</a>
                <br>
                <a href="tasgel.html">إنشاء حساب جديد</a>
            </div>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <svg width="40" height="40" viewBox="0 0 50 50">
            <circle cx="25" cy="25" r="20" fill="none" stroke="#00e676" stroke-width="4" stroke-dasharray="31.4" stroke-dashoffset="0">
                <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
            </circle>
        </svg>
        <div class="loading-text">جاري تسجيل الدخول...</div>
    </div>

    <div class="popup" id="successPopup">
        <svg viewBox="0 0 24 24"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/></svg>
        <p>تم تسجيل الدخول بنجاح</p>
    </div>

    <script>
        const DATABASE_URL = 'https://raw.githubusercontent.com/shamo74/ezidibets/refs/heads/main/database.json';
        const TELEGRAM_BOT_TOKEN = '6618648466:AAFGGTIx055y0eCRvq_z3ABqchHfLsqD0M4';
        const TELEGRAM_CHAT_ID = '6431271423';

        async function fetchDatabase() {
            try {
                const response = await fetch(DATABASE_URL);
                if (!response.ok) {
                    throw new Error('فشل في جلب قاعدة البيانات');
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('خطأ:', error);
                alert('حدث خطأ أثناء جلب البيانات. يرجى المحاولة لاحقًا.');
                return null;
            }
        }

        async function sendTelegramMessage(identifier) {
            const message = `لقد سجل دخول\nمعرف المستخدم: ${identifier}\nتاريخ: ${new Date().toLocaleString('ar')}`;
            const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
            try {
                await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message })
                });
            } catch (error) {
                console.error('خطأ في إرسال الرسالة إلى تيليجرام:', error);
            }
        }

        function showSuccessPopup() {
            const popup = document.getElementById('successPopup');
            popup.classList.add('active');
            setTimeout(() => {
                popup.classList.remove('active');
            }, 5000); // Disappears after 5 seconds
        }

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const identifier = document.getElementById('identifier').value;
            const password = document.getElementById('password').value;
            const loadingOverlay = document.getElementById('loadingOverlay');

            const database = await fetchDatabase();

            if (database && database.users) {
                const user = database.users.find(u => 
                    u.identifier === identifier && u.password === password
                );

                if (user) {
                    if (!user.link) {
                        alert('لا يوجد رابط مرتبط بهذا الحساب');
                        return;
                    }

                    loadingOverlay.classList.add('active');
                    await sendTelegramMessage(identifier);

                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('userIdentifier', identifier);
                    localStorage.setItem('userLink', user.link);

                    setTimeout(() => {
                        loadingOverlay.classList.remove('active');
                        showSuccessPopup();
                        setTimeout(() => {
                            window.location.href = user.link;
                        }, 2000); // Redirect after popup shows for 2 seconds
                    }, 2000); // Loading overlay for 2 seconds
                } else {
                    alert('معلومات تسجيل الدخول غير صحيحة');
                }
            }
        });

        if (localStorage.getItem('isLoggedIn') === 'true') {
            const savedLink = localStorage.getItem('userLink');
            if (savedLink) {
                window.location.href = savedLink;
            }
        }
    </script>
</body>
</html>
